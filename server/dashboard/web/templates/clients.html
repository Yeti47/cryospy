{{ define "content" }}
<h2>Clients</h2>
<a href="/clients/new" class="btn">New Client</a>
{{ if .Error }}
<p class="error">{{ .Error }}</p>
{{ end }}
<div class="client-grid">
    {{ range .Clients }}
    <div class="client-card">
        <h3>{{ .ID }}</h3>
        {{ if .StorageInfo }}
        <div class="storage-info">
            <div class="storage-header">
                <span class="storage-label">Storage Usage</span>
                {{ if eq .StorageInfo.TotalAvailableBytes 0 }}
                <span class="storage-status unlimited">Unlimited</span>
                {{ else }}
                <span class="storage-status {{ getStorageColorClass .StorageInfo.UsagePercent false }}">
                    {{ formatStoragePercent .StorageInfo.UsagePercent }}
                </span>
                {{ end }}
            </div>
            <div class="storage-bar-container">
                {{ if eq .StorageInfo.TotalAvailableBytes 0 }}
                <div class="storage-bar unlimited">
                    <div class="storage-fill unlimited"></div>
                </div>
                <div class="storage-details">
                    <span>{{ formatBytes .StorageInfo.TotalUsedBytes }} used</span>
                </div>
                {{ else }}
                <div class="storage-bar">
                    <div class="storage-fill {{ getStorageColorClass .StorageInfo.UsagePercent false }}" 
                         style="width: {{ .StorageInfo.UsagePercent }}%"></div>
                </div>
                <div class="storage-details">
                    <span>{{ formatBytes .StorageInfo.TotalUsedBytes }} / {{ formatBytes .StorageInfo.TotalAvailableBytes }}</span>
                    <span class="storage-remaining">{{ formatBytes (sub .StorageInfo.TotalAvailableBytes .StorageInfo.TotalUsedBytes) }} remaining</span>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
        <form action="/clients/{{ .ID }}/settings" method="post" id="settings-form-{{ .ID }}">
            <div class="settings-columns">
                <div class="settings-column">
                    <h4>General</h4>
                    <div class="form-group">
                        <label for="storage_limit_{{ .ID }}">Storage Limit (MB)</label>
                        <input type="number" id="storage_limit_{{ .ID }}" name="storage_limit" value="{{ .StorageLimitMegabytes }}" required>
                    </div>
                    
                    <h4>Recording</h4>
                    <div class="form-group">
                        <label for="clip_duration_{{ .ID }}">Clip Duration (s)</label>
                        <input type="number" id="clip_duration_{{ .ID }}" name="clip_duration" value="{{ .ClipDurationSeconds }}" required min="30" max="1800">
                    </div>
                    <div class="form-group">
                        <label for="capture_codec_{{ .ID }}">Capture Codec</label>
                        <select id="capture_codec_{{ .ID }}" name="capture_codec">
                            {{ $currentCaptureCodec := .CaptureCodec }}
                            {{ range $.SupportedCaptureCodecs }}
                            <option value="{{ . }}" {{ if eq . $currentCaptureCodec }}selected{{ end }}>{{ . }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="capture_frame_rate_{{ .ID }}">Frame Rate (FPS)</label>
                        <input type="number" step="0.1" id="capture_frame_rate_{{ .ID }}" name="capture_frame_rate" value="{{ .CaptureFrameRate }}">
                    </div>
                </div>
                <div class="settings-column">
                    <h4>Motion Detection</h4>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="motion_only_{{ .ID }}" name="motion_only" {{ if .MotionOnly }}checked{{ end }}>
                        <label for="motion_only_{{ .ID }}">Motion Only</label>
                    </div>
                    <div class="form-group">
                        <label for="motion_min_area_{{ .ID }}">Min Area (square pixels)</label>
                        <input type="number" id="motion_min_area_{{ .ID }}" name="motion_min_area" value="{{ .MotionMinArea }}">
                    </div>
                    <div class="form-group">
                        <label for="motion_max_frames_{{ .ID }}">Max Frames</label>
                        <input type="number" id="motion_max_frames_{{ .ID }}" name="motion_max_frames" value="{{ .MotionMaxFrames }}">
                    </div>
                    <div class="form-group">
                        <label for="motion_warm_up_frames_{{ .ID }}">Warm-Up Frames</label>
                        <input type="number" id="motion_warm_up_frames_{{ .ID }}" name="motion_warm_up_frames" value="{{ .MotionWarmUpFrames }}">
                    </div>
        
                    <h4>Post-Processing</h4>
                    <div class="form-group">
                        <label for="downscale_resolution_{{ .ID }}">Downscale</label>
                        <select id="downscale_resolution_{{ .ID }}" name="downscale_resolution">
                            {{ $currentResolution := .DownscaleResolution }}
                            {{ range $.SupportedResolutions }}
                            <option value="{{ . }}" {{ if eq . $currentResolution }}selected{{ end }}>{{ if eq . "" }}None{{ else }}{{ . }}{{ end }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="grayscale_{{ .ID }}" name="grayscale" {{ if .Grayscale }}checked{{ end }}>
                        <label for="grayscale_{{ .ID }}">Grayscale</label>
                    </div>
                                        <div class="form-group">
                        <label for="output_format_{{ .ID }}">Output Format</label>
                        <select id="output_format_{{ .ID }}" name="output_format">
                            {{ $currentOutputFormat := .OutputFormat }}
                            {{ range $.SupportedOutputFormats }}
                            <option value="{{ . }}" {{ if eq . $currentOutputFormat }}selected{{ end }}>{{ . }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="output_codec_{{ .ID }}">Output Codec</label>
                        <select id="output_codec_{{ .ID }}" name="output_codec">
                            {{ $currentOutputCodec := .OutputCodec }}
                            {{ range $.SupportedOutputCodecs }}
                            <option value="{{ . }}" {{ if eq . $currentOutputCodec }}selected{{ end }}>{{ . }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="video_bitrate_{{ .ID }}">Video Bitrate</label>
                        <select id="video_bitrate_{{ .ID }}" name="video_bitrate">
                            {{ $currentVideoBitrate := .VideoBitRate }}
                            {{ range $.SupportedVideoBitrates }}
                            <option value="{{ . }}" {{ if eq . $currentVideoBitrate }}selected{{ end }}>{{ . }}</option>
                            {{ end }}
                        </select>
                    </div>
                </div>
            </div>
        </form>
        <div class="actions">
            <button type="submit" class="btn" form="settings-form-{{ .ID }}">Save</button>
            <form action="/clients/{{ .ID }}/delete" method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete client \'{{ .ID }}\'?');">Delete</button>
            </form>
        </div>
        <small>Created: {{ (.CreatedAt | toLocal).Format "2006-01-02 15:04:05" }}<br>Updated: {{ (.UpdatedAt | toLocal).Format "2006-01-02 15:04:05" }}</small>
    </div>
    {{ end }}
</div>
{{ if not .Clients }}
<p>No clients found.</p>
{{ end }}
{{ end }}
